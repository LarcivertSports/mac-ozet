<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Yemek Kalori Tahmini</title>
  <link rel="stylesheet" href="style.css">
  <script>
    let mealCount = 1;
    function addMealBlock() {
      mealCount++;
      const container = document.getElementById("meal-blocks");
      const block = document.createElement("div");
      block.className = "meal-block";
      block.innerHTML = `
        <label for="image${mealCount}">Yemek Fotoğrafı ${mealCount}:</label>
        <input type="file" id="image${mealCount}" name="image${mealCount}" accept="image/*" onchange="previewImage(this, ${mealCount})" required>
        <label for="meal_type${mealCount}">Öğün Seç:</label>
        <select id="meal_type${mealCount}" name="meal_type${mealCount}">
          <option value="Kahvaltı">Kahvaltı</option>
          <option value="Öğle">Öğle</option>
          <option value="Akşam">Akşam</option>
        </select>
        <div class="preview" id="preview${mealCount}"></div>
        <hr>
      `;
      container.appendChild(block);
      document.getElementById("meal-count").innerText = `Toplam öğün: ${mealCount}`;
    }
    function previewImage(input, count) {
      const preview = document.getElementById(`preview${count}`);
      preview.innerHTML = "";
      const file = input.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = document.createElement("img");
          img.src = e.target.result;
          img.className = "preview-img";
          preview.appendChild(img);
        };
        reader.readAsDataURL(file);
      }
    }
    function saveToLocalStorage() {
      const mealBlocks = document.querySelectorAll('.meal-block');
      const meals = [];
      mealBlocks.forEach((block, index) => {
        const imageInput = block.querySelector(`input[type="file"]`);
        const mealSelect = block.querySelector(`select`);
        if (imageInput.files.length > 0) {
          const imageName = imageInput.files[0].name;
          const mealType = mealSelect.value;
          const timestamp = new Date().toISOString();

          meals.push({ imageName, mealType, timestamp });
        }
      });

      localStorage.setItem("mealData", JSON.stringify(meals));
      alert("Öğünler başarıyla kaydedildi!");
    }
  </script>
</head>
<body>
  <div class="container">
    <h1>🍽️ Kalori Tahmini Sistemi</h1>
    <form>
      <div id="meal-blocks">
        <div class="meal-block">
          <label for="image1">Yemek Fotoğrafı 1:</label>
          <input type="file" id="image1" name="image1" accept="image/*" onchange="previewImage(this, 1)" required>
          <label for="meal_type1">Öğün Seç:</label>
          <select id="meal_type1" name="meal_type1">
            <option value="Kahvaltı">Kahvaltı</option>
            <option value="Öğle">Öğle</option>
            <option value="Akşam">Akşam</option>
          </select>
          <div class="preview" id="preview1"></div>
          <hr>
        </div>
      </div>
      <p id="meal-count">Toplam öğün: 1</p>
      <button type="button" onclick="addMealBlock()">➕ Öğün Ekle</button>
      <button type="button" onclick="saveToLocalStorage()">💾 Kaydet</button>
    </form>
  </div>
</body>
</html>
